\documentclass[11pt,a4paper]{article}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{booktabs}
\usepackage{enumitem}

\geometry{margin=1in}

\title{\textbf{Comparative Analysis and Final Strategy: Solvers for Food Optimization}}
\author{Edo}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
This combined technical report synthesizes two working documents: (1) \emph{comparison\_nl.tex}, a comprehensive comparison of multiple solver implementations (linear MILP, non-linear with piecewise approximation, non-linear with Dinkelbach, linear-quadratic, and BQUBO approaches), and (2) \emph{binary\_runner.tex}, which documents the final adopted Binary/BQUBO formulation strategy. The first part analyzes mathematical formulations, algorithmic approaches, computational complexity, and trade-offs between modeling accuracy and efficiency. The second part details the binary formulation in depth, showing how it maintains tractability for both classical MILP solvers and hybrid quantum-classical samplers. Together, this narrative provides both methodological context and the chosen implementation strategy.
\end{abstract}

\section{Introduction}

The food optimization problem allocates agricultural land across multiple farms to grow various crops, maximizing a weighted combination of nutritional value, sustainability, affordability, and other attributes while satisfying land availability and crop diversity constraints. This report analyzes multiple approaches to formulating and solving this problem. Part 1 compares five distinct solver implementations with different mathematical properties and computational characteristics. Part 2 concludes with the binary (BQUBO) strategy, which is now our primary implementation due to its strong balance between tractability and quantum-solver compatibility.

\subsection{Problem Context}

Given:
\begin{itemize}
    \item $\mathcal{F}$: Set of farms with land availability $L_f$ for $f \in \mathcal{F}$
    \item $\mathcal{C}$: Set of crops with attributes
    \item $\mathcal{G}$: Set of food groups with diversity requirements
    \item $w_k$: Weights for objectives
\end{itemize}

Decision variables (general):
\begin{itemize}
    \item $A_{fc} \in [0, L_f]$: Continuous area allocated to crop $c$ on farm $f$
    \item $Y_{fc} \in \{0,1\}$: Binary indicator for crop $c$ on farm $f$
\end{itemize}

Core constraints:
\begin{align}
\sum_{c \in \mathcal{C}} A_{fc} &\leq L_f \quad \forall f, \\
A_{fc} &\geq A_{\min,c} \cdot Y_{fc} \quad \forall f,c, \\
A_{fc} &\leq L_f \cdot Y_{fc} \quad \forall f,c, \\
\sum_{c \in \mathcal{G}_g} Y_{fc} &\geq N_{\min,g} \quad \forall f,g
\end{align}

\section{Part 1: Comparative Analysis of Solver Approaches}

\subsection{Solver 1: Linear Objective (\texttt{solver\_runner.py})}

Uses a linear objective function, yielding a Mixed-Integer Linear Program (MILP).

\subsubsection{Mathematical Formulation}

\begin{equation}
\max \sum_{f \in \mathcal{F}} \sum_{c \in \mathcal{C}} \left(\sum_{k} w_k \cdot \text{attr}_{k,c}\right) \cdot A_{fc}
\end{equation}

\textbf{Advantages:}
\begin{itemize}
    \item Simplest formulation with fewest variables ($2n$)
    \item Exact optimal solutions guaranteed
    \item Fast solve times with mature MILP solvers (CBC, Gurobi)
    \item No approximation errors
\end{itemize}

\textbf{Limitations:}
\begin{itemize}
    \item Linear returns assumption is unrealistic
    \item Cannot model diminishing returns or interaction effects
\end{itemize}

\subsection{Solver 2: Non-Linear with Piecewise Approximation (\texttt{solver\_runner\_NLN.py})}

Models diminishing returns using a concave power function approximated piecewise.

\subsubsection{Mathematical Formulation}

Objective with diminishing returns:
\begin{equation}
\max \sum_{f \in \mathcal{F}} \sum_{c \in \mathcal{C}} \left(\sum_{k} w_k \cdot \text{attr}_{k,c}\right) \cdot f(A_{fc})
\end{equation}

where $f(A) = A^\alpha$ with $\alpha = 0.548$ for diminishing returns.

\textbf{Piecewise Approximation:}
For each farm-crop pair, define breakpoints $0 = b_0 < b_1 < \cdots < b_K = L_f$ and introduce:
\begin{itemize}
    \item Convex combination weights $\lambda_{fc,i} \in [0,1]$ with $\sum_i \lambda_{fc,i} = 1$
    \item SOS2 constraints (at most two consecutive $\lambda$ variables can be nonzero)
    \item Approximated function value $\tilde{f}_{fc} = \sum_i \lambda_{fc,i} \cdot f(b_i)$
\end{itemize}

Modified objective:
\begin{equation}
\max \sum_{f,c} \left(\sum_k w_k \cdot \text{attr}_{k,c}\right) \cdot \tilde{f}_{fc}
\end{equation}

\textbf{Variable Count:} $(K+4)|\mathcal{F}||\mathcal{C}| \approx 14n$ for $K=10$.

\textbf{Advantages:}
\begin{itemize}
    \item Models realistic diminishing returns
    \item Economically justified
    \item Approximation accuracy controllable via $K$
    \item Can be solved exactly with MINLP solvers (Pyomo)
\end{itemize}

\textbf{Limitations:}
\begin{itemize}
    \item $7\times$ more variables than linear
    \item $2-4\times$ slower solve times
    \item Approximation error (though small with $K \geq 10$)
\end{itemize}

\subsection{Solver 3: Fractional Non-Linear (\texttt{solver\_runner\_NLD.py})}

Models efficiency/benefit-per-unit-area using Dinkelbach's fractional programming algorithm.

\subsubsection{Mathematical Formulation}

Fractional objective:
\begin{equation}
\max \frac{\sum_{f,c} w_k \cdot \text{benefit}_{k,c} \cdot A_{fc}}{\sum_{f,c} A_{fc} + \epsilon}
\end{equation}

\textbf{Dinkelbach's Algorithm:}
Iteratively solve parametric MILPs with decreasing parameter $\lambda$. Converges superlinearly to the optimal fractional solution in typically 5-15 iterations.

\textbf{Advantages:}
\begin{itemize}
    \item No additional variables ($2n$ per iteration)
    \item Exact solution for fractional objective
    \item Fast convergence (superlinear)
    \item Well-studied convergence guarantees
\end{itemize}

\textbf{Limitations:}
\begin{itemize}
    \item Requires multiple MILP solves ($T \times$ single-solve time where $T \approx 8$)
    \item Total time can be longer than linear solver
    \item Limited to fractional objectives
\end{itemize}

\subsection{Solver 4: Linear-Quadratic with Synergy (\texttt{solver\_runner\_LQ.py})}

Combines linear returns with quadratic synergy effects between crops in the same food group.

\subsubsection{Mathematical Formulation}

\begin{equation}
\max \underbrace{\sum_{f,c} v_c \cdot A_{fc}}_{\text{Linear}} + \underbrace{w_s \sum_f \sum_{\substack{c_1,c_2 \in \mathcal{G}_g \\ c_1 < c_2}} s_{c_1,c_2} \cdot Y_{fc_1} \cdot Y_{fc_2}}_{\text{Quadratic synergy}}
\end{equation}

For MILP (PuLP), the quadratic term is linearized using McCormick constraints:
\begin{align}
Z_{fc_1c_2} &\leq Y_{fc_1}, \quad Z_{fc_1c_2} \leq Y_{fc_2}, \\
Z_{fc_1c_2} &\geq Y_{fc_1} + Y_{fc_2} - 1
\end{align}

This linearization is exact for binary variables.

\textbf{Variable Count:} $2n + |\mathcal{F}| \cdot |\mathcal{S}| \approx 2.3n$ for typical synergy pair counts.

\textbf{Advantages:}
\begin{itemize}
    \item Models crop interaction/synergy
    \item Exact solutions
    \item $75\%$ fewer variables than NLN
    \item Comparable speed to linear
    \item Native quadratic support in CQM and MIQP solvers
\end{itemize}

\textbf{Limitations:}
\begin{itemize}
    \item Cannot model diminishing returns
    \item Requires synergy matrix definition
    \item Slightly more complex than pure linear
\end{itemize}

\subsection{Solver 5: BQUBO Binary Formulation (\texttt{solver\_runner\_BQUBO.py})}

Uses only binary variables representing fixed-size (1-acre) plot allocations, offering simplicity and direct quantum solver compatibility.

\subsubsection{Mathematical Formulation}

Decision variables (binary only):
\begin{itemize}
    \item $Y_{fc} \in \{0,1\}$: Binary allocation of a fixed plot to farm $f$, crop $c$
\end{itemize}

Objective:
\begin{equation}
\max \sum_{f,c} v_c \cdot Y_{fc}
\end{equation}

Constraints (simplified):
\begin{align}
\sum_{c} Y_{fc} &\leq \lfloor L_f \rfloor, \\
\sum_{c \in \mathcal{G}_g} Y_{fc} &\geq N_{\min,g}
\end{align}

\textbf{Variable Count:} $n$ variables (fewest of all formulations).

\textbf{Advantages:}
\begin{itemize}
    \item Fewest variables ($50\%$ of linear)
    \item Fastest classical solve times (PuLP/CBC)
    \item Native format for D-Wave quantum annealers (BQM)
    \item Direct CQM-to-BQM conversion for quantum solvers
    \item Conceptually simple (binary select/deselect)
\end{itemize}

\textbf{Limitations:}
\begin{itemize}
    \item Fixed-size allocation ($1$ acre per plot) limits modeling flexibility
    \item Cannot model variable or fractional allocations
    \item Discretization error for land constraints ($\lfloor L_f \rfloor$ vs $L_f$)
    \item Lower modeling realism than continuous formulations
\end{itemize}

\section{Comparative Summary}

\subsection{Variable Count}

\begin{table}[h]
\centering
\caption{Variable count for problem size $n = |\mathcal{F}||\mathcal{C}|$ (with $K=10$, $|\mathcal{S}| \approx 0.15n$)}
\begin{tabular}{lc}
\toprule
\textbf{Solver} & \textbf{Variables} \\
\midrule
BQUBO & $n$ \\
Linear, NLD, LQ (CQM) & $2n$ \\
LQ (PuLP) & $2.3n$ \\
NLN & $14n$ \\
\bottomrule
\end{tabular}
\end{table}

\subsection{Solve Time Estimates}

For representative $n = 150$ problem (5 farms, 30 crops):

\begin{table}[h]
\centering
\caption{Typical solve times}
\begin{tabular}{lcc}
\toprule
\textbf{Solver} & \textbf{Variables} & \textbf{Time (approx)} \\
\midrule
BQUBO & 150 & 0.10s \\
Linear & 300 & 0.15s \\
LQ & 350/300 & 0.18s \\
NLD & 300 & 1.2s (8 iterations) \\
NLN (PuLP) & 2,100 & 0.45s \\
\bottomrule
\end{tabular}
\end{table}

\section{Part 2: Final Strategyâ€”Binary (BQUBO) Formulation}

The binary formulation is our chosen strategy because it aligns variable semantics with the problem's capacity constraints and achieves strong balance between tractability, speed, and quantum-solver compatibility. This section provides detailed documentation of the binary/BQUBO implementation.

\subsection{Overview}

The binary formulation models the problem in two complementary ways depending on application:

\begin{enumerate}
    \item \textbf{Binary Formulation (Even Grid):} Land is discretized into equal-sized plots; each plot is assigned to at most one crop.
    \item \textbf{Continuous Formulation (Uneven Distribution):} Farms have varying sizes; areas are treated as continuous variables.
\end{enumerate}

Both formulations can be solved using classical solvers (PuLP with Gurobi/CBC) or converted to BQM for D-Wave hybrid quantum-classical samplers.

\subsection{Decision Variables}

\subsubsection{Continuous Formulation}

\begin{itemize}
    \item $A_{f,c} \in \mathbb{R}^+$: Continuous area (hectares) allocated to crop $c$ on farm $f$
    \item $Y_{f,c} \in \{0,1\}$: Binary selection indicator (crop $c$ is planted on farm $f$)
\end{itemize}

\subsubsection{Binary Formulation}

\begin{itemize}
    \item $Y_{p,c} \in \{0,1\}$: Binary assignment variable ($Y_{p,c}=1$ if plot $p$ is assigned to crop $c$)
\end{itemize}

Note: In the binary formulation, there are no continuous area variables. Each plot has fixed area $a_p$, and assignment is discrete.

\subsection{Parameters and Sets}

\begin{itemize}
    \item $F$: Set of farms (continuous) or plots (binary)
    \item $C$: Set of crops, with food-group partitions $C_g \subseteq C$
    \item $L_f$: Available land on farm $f$ (hectares)
    \item $a_p$: Fixed area of plot $p$ in binary grid (hectares)
    \item $A_{\min,c}$: Minimum planting area for crop $c$ if selected
    \item $N_{\min,g}, N_{\max,g}$: Group-level crop diversity min/max
    \item $v_c$: Composite value/benefit score for crop $c$ (weighted combination of nutritional value, sustainability, affordability, etc.)
\end{itemize}

\subsection{Objective Functions}

\subsubsection{Continuous Formulation}

\begin{equation}
Z = \frac{1}{\sum_{f} L_f} \sum_{f \in F} \sum_{c \in C} v_c \cdot A_{f,c}
\end{equation}

Normalized to account for varying farm sizes.

\subsubsection{Binary Formulation}

\begin{equation}
Z = \frac{1}{\sum_{p} a_p} \sum_{p \in F} \sum_{c \in C} a_p \cdot v_c \cdot Y_{p,c}
\end{equation}

Each selected plot-crop assignment contributes its plot area times crop value.

\subsection{Constraints}

\subsubsection{Continuous Formulation}

\begin{align}
\sum_{c \in C} A_{f,c} &\leq L_f \quad \forall f, \\
A_{f,c} &\geq A_{\min,c} \cdot Y_{f,c} \quad \forall f,c, \\
A_{f,c} &\leq L_f \cdot Y_{f,c} \quad \forall f,c, \\
\sum_{c \in C_g} Y_{f,c} &\geq N_{\min,g} \quad \forall f,g
\end{align}

\subsubsection{Binary Formulation}

\begin{align}
\sum_{c \in C} Y_{p,c} &\leq 1 \quad \forall p \quad \text{(each plot receives at most one crop)}, \\
\sum_{c \in C_g} Y_{p,c} &\geq N_{\min,g} \quad \forall p \quad \text{(diversity constraints)}
\end{align}

The at-most-one constraint is often implicit if variables are constructed as mutually exclusive; otherwise enforced as a linear constraint.

\subsection{Solution Methods}

\subsubsection{Classical (PuLP)}

\begin{itemize}
    \item Gurobi when available (fastest)
    \item CBC (open-source COIN-OR branch-and-cut)
    \item Direct MILP/ILP solving
\end{itemize}

\subsubsection{Hybrid Quantum-Classical (D-Wave)}

\begin{itemize}
    \item Convert CQM to BQM using \texttt{cqm\_to\_bqm}
    \item Solve with \texttt{LeapHybridBQMSampler}
    \item Constraints embedded as penalty terms
    \item Leverages QPU for scaling to large problems
\end{itemize}

\subsection{Computational Complexity}

\subsubsection{Complexity Measures}

\begin{itemize}
    \item \textbf{Continuous:} NP-hard mixed-integer nonlinear program
    \item \textbf{Binary:} NP-hard binary integer program
    \item \textbf{Variables:}
    \begin{itemize}
        \item Continuous: $2 \times |F| \times |C|$
        \item Binary: $|F| \times |C|$
    \end{itemize}
    \item \textbf{Constraints:}
    \begin{itemize}
        \item Continuous: $|F| + 2|F||C| + 2|F||G|$
        \item Binary: $|F| + 2|F||G|$
    \end{itemize}
\end{itemize}

\subsubsection{Comparative Solver Performance}

\begin{table}[h]
\centering
\caption{Solver comparison (classical algorithms)}
\begin{tabular}{ll}
\toprule
\textbf{Solver} & \textbf{Algorithm / Strengths} \\
\midrule
PuLP + Gurobi & Branch-and-bound with cuts; proven optimality; fast \\
PuLP + CBC & Open-source branch-and-cut; good for MILP \\
D-Wave CQM & Quantum-classical hybrid; mixed-integer support \\
D-Wave BQM & Binary-only; maximum QPU utilization \\
\bottomrule
\end{tabular}
\end{table}

\subsection{Conclusion}

The binary (BQUBO) formulation is an excellent operational choice because it:

\begin{enumerate}
    \item \textbf{Minimizes overhead:} Fewest variables among all approaches; reduces solver burden.
    \item \textbf{Maintains tractability:} Both classical (PuLP/Gurobi/CBC) and quantum-hybrid (D-Wave) methods perform well.
    \item \textbf{Aligns with quantum hardware:} Native BQM format for D-Wave quantum annealers.
    \item \textbf{Simple and fast:} Classical solve times are among the fastest; conceptually straightforward.
\end{enumerate}

Trade-offs:
\begin{itemize}
    \item Loses modeling flexibility of continuous allocation (fixed 1-acre plots).
    \item Discretization error in land constraints.
    \item Lower realism for problems requiring variable plot sizes.
\end{itemize}

For most practical agricultural optimization problems where plot-based allocation is natural (e.g., crop rotation at field scale), the binary formulation provides an excellent balance of tractability, speed, and quantum compatibility.

\section{Integration into \texttt{current\_structure.tex}}

To incorporate this combined material into your main project document (\texttt{current\_structure.tex}), use one of the following approaches:

\subsubsection{Option 1: Import Entire File}

In \texttt{current\_structure.tex}, add at the appropriate section:
\begin{verbatim}
\input{Latex/combined_trials.tex}
\end{verbatim}

\subsubsection{Option 2: Selective Copy-Paste}

Copy individual sections from this file:
\begin{itemize}
    \item Abstract and Introduction â†’ Project overview/context
    \item Part 1 (Comparative Analysis) â†’ Methods / Experimental approaches
    \item Part 2 (Final Strategy) â†’ Methods / Final implementation
    \item Comparative Summary â†’ Results / Trade-off discussion
\end{itemize}

\subsubsection{Suggested Placement}

\begin{enumerate}
    \item \textbf{Abstract / Executive Summary:} Include abstract of this document
    \item \textbf{Introduction / Literature:} Problem context from Section~1
    \item \textbf{Methods:} Comparative solver analysis (Part~1) and final binary strategy (Part~2)
    \item \textbf{Appendix (optional):} Detailed solver specifications and command-line usage
\end{enumerate}

\end{document}

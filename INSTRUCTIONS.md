# LLM Agent Instructions

This document outlines the tasks for the LLM agent to modify the land allocation optimization scripts.

## Development Loop

For each task, follow this iterative development loop:

1.  **Write:** Implement the required code changes in the specified files.
2.  **Run:** Execute the modified script to ensure it runs without errors.
3.  **Test:** Verify that the output is correct and the changes meet the requirements. Use existing test files or create new ones if necessary.
4.  **Rewrite:** If there are errors or the output is incorrect, go back to the "Write" step and refine the code.
5.  **Finalize:** Once the task is complete and verified, move to the next instruction.

---

## Task 1: Update `Grid_Refinement.py`

**Goal:** Modify the grid and farm generation logic to use a fixed total area and introduce an even grid for patches.

### Instructions:

1.  **Edit `Grid_Refinement.py`:**
    *   In the `create_discretized_scenario` function, replace the call to `generate_patches` (which is an alias for `patch_sampler.generate_farms`) with `patch_sampler.generate_grid`.
    *   When calling `generate_grid`, pass the `n_patches` and a fixed `total_land` of 100.0 ha. This will create a grid of `n_patches` *equal-sized* rectangles that sum to 100 ha.
    *   In the `create_continuous_scenario` function, ensure that the farms generated by `farm_sampler.generate_farms` are scaled to always sum up to a total area of 100.0 ha, while maintaining their relative size distribution.
    *   The `run_grid_refinement_analysis` function should now compare:
        *   An **uneven grid** of `n` farms (continuous variables) totaling 100 ha.
        *   An **even grid** of `n` patches (binary variables) totaling 100 ha.

---

## Task 2: Update Documentation `solver_runner_BINARY_documentation.tex`

**Goal:** Correct the documentation to reflect the two types of land discretization: even grids and unevenly distributed farms.

### Instructions:

1.  **Edit `solver_runner_BINARY_documentation.tex`:**
    *   Update the "Gridding Process" section (Section 1.2).
    *   Describe two distinct methods for land representation:
        1.  **Even Grid Discretization:** The total land area is divided into $|P|$ plots of equal size. The area of each plot is $a_p = A_{\text{total}} / |P|$. This is used for the discretized patch-based model.
        2.  **Uneven Farm Distribution:** The total land area is distributed among $|F|$ farms, where each farm $f$ has a different area $A_f$ based on a statistical distribution from `farm_sampler.py`, such that $\sum_{f \in F} A_f = A_{\text{total}}$. This is used for the continuous farm-based model.
    *   Modify the mathematical formulation sections (Parameters, Constraints) to be clear about which representation is being discussed. For instance, when discussing the binary model, refer to plots from an even grid. When discussing a potential continuous model, refer to farms with variable areas.
    *   Ensure the document clearly distinguishes between a "patch" (from an even grid) and a "farm" (from an uneven distribution).

---

## Task 3: Update `solver_runner_BINARY.py` to Match Documentation

**Goal:** Align the implementation of the binary solver with the updated documentation, allowing it to handle both even and uneven land distributions.

### Instructions:

1.  **Edit `solver_runner_BINARY.py`:**
    *   Modify the script so that it can be configured to use either an even grid of patches or an uneven distribution of farms for the binary formulation.
    *   The `load_food_data` function or the `main` function should be updated to accept a parameter that specifies the land generation method (e.g., `'even_grid'` or `'uneven_distribution'`).
    *   Based on this parameter, the script should call the appropriate generator (`patch_sampler.generate_grid` for an even grid, or `farm_sampler.generate_farms` for an uneven distribution) to create the `land_availability` dictionary.
    *   The `create_cqm` and `solve_with_pulp` functions should correctly interpret the `land_availability` data. Since the binary formulation assumes each "plantation" is a discrete unit, the `land_availability` for each farm/patch should be interpreted as the number of available plots/units within that farm/patch. For an even grid, this will be 1 for each patch. For an uneven distribution, this will be the area of the farm rounded to the nearest integer.
    *   Update comments and logging statements within the script to reflect these changes and clarify which land generation method is being used for a given run.
